{
    "application": "megatron-lm",
    "software": [
        "python",
        "mpirun",
        "cuda",
        "cudnn",
        "hpcx",
        "nccl",
        "wandb",
        "tcpx",
        "transformer_engine"
    ],
    "modules": [
        "cuda/12.1",
        "cudnn/8.9.7",
        "hpcx/2.17.1"
    ],
    "environment_variables": {
        "UDS_PATH": "/run/tcpx-${SLURM_JOB_ID}",
        "USE_TCPX": "yes",
        "NCCL_NET": "GPUDirectTCPX_v7",
        "NCCL_SOCKET_IFNAME": "enp0s12",
        "NCCL_GPUDIRECTTCPX_CTRL_DEV": "enp0s12",
        "NCCL_GPUDIRECTTCPX_SOCKET_IFNAME": "enp6s0,enp12s0,enp134s0,enp140s0",
        "NCCL_CROSS_NIC": "0",
        "NCCL_ALGO": "Ring",
        "NCCL_PROTO": "Simple",
        "NCCL_NSOCKS_PERTHREAD": "4",
        "NCCL_SOCKET_NTHREADS": "1",
        "NCCL_DYNAMIC_CHUNK_SIZE": "524288",
        "NCCL_P2P_NET_CHUNKSIZE": "524288",
        "NCCL_P2P_PCI_CHUNKSIZE": "524288",
        "NCCL_P2P_NVL_CHUNKSIZE": "1048576",
        "CUDA_VISIBLE_DEVICES": "0,1,2,3,4,5,6,7",
        "NCCL_NET_GDR_LEVEL": "PIX",
        "NCCL_P2P_PXN_LEVEL": "0",
        "NCCL_GPUDIRECTTCPX_UNIX_CLIENT_PREFIX": "${UDS_PATH}",
        "NCCL_GPUDIRECTTCPX_PROGRAM_FLOW_STEERING_WAIT_MICROS": "500000",
        "NCCL_GPUDIRECTTCPX_TX_BINDINGS": "enp6s0:8-21,112-125;enp12s0:8-21,112-125;enp134s0:60-73,164-177;enp140s0:60-73,164-177",
        "NCCL_GPUDIRECTTCPX_RX_BINDINGS": "enp6s0:22-35,126-139;enp12s0:22-35,126-139;enp134s0:74-87,178-191;enp140s0:74-87,178-191",
        "LD_LIBRARY_PATH": "/var/lib/tcpx/lib64:${LD_LIBRARY_PATH}",
        "MASTER_ADDR": "$(scontrol show hostname $SLURM_JOB_NODELIST | head -n1)",
        "MASTER_PORT": "((10000 + ($SLURM_JOBID % 50000)))",
        "NUM_GPU_PER_NODE": "8",
        "NODE_TYPE": "H100",
        "NUM_NODES": "$SLURM_JOB_NUM_NODES",
        "NUM_GPUS": "((${NUM_NODES} * ${NUM_GPU_PER_NODE}))",
        "HIDDEN_SIZE": "4096",
        "FFN_HIDDEN_SIZE": "14336",
        "NUM_LAYERS": "32",
        "NUM_HEADS": "32",
        "NUM_KEY_VALUE_HEADS": "8",
        "SEQ_LENGTH": "8192",
        "TENSOR_PARALLEL_SIZE": "2",
        "PIPELINE_PARALLEL_SIZE": "2",
        "CONTEXT_PARALLEL_SIZE": "1",
        "DATA_PARALLEL_SIZE": "((${NUM_GPUS} / (${TENSOR_PARALLEL_SIZE} * ${PIPELINE_PARALLEL_SIZE})))",
        "MICRO_BATCH_SIZE": "1",
        "GLOBAL_BATCH_SIZE": "1024",
        "TRAIN_STEPS": "25000",
        "LR_DECAY_ITERS": "25000",
        "LR": "2.5e-5",
        "MIN_LR": "2.5E-6",
        "LR_WARMUP_STEPS": "2000",
        "WEIGHT_DECAY": "0.1",
        "GRAD_CLIP": "1",
        "TOKENIZER_MODEL": "/home/ext_kazuki_fujii_rio_gsic_titech/hf_checkpoints/Meta-Llama-3-8B/tokenizer.json",
        "CHECKPOINT_DIR": "/home/ext_kazuki_fujii_rio_gsic_titech/checkpoints/hf-to-megatron/Llama-3-8b/tp${TENSOR_PARALLEL_SIZE}-pp${PIPELINE_PARALLEL_SIZE}",
        "CHECKPOINT_SAVE_DIR": "/home/ext_kazuki_fujii_rio_gsic_titech/checkpoints/Llama-3-8b/tp${TENSOR_PARALLEL_SIZE}-pp${PIPELINE_PARALLEL_SIZE}-ct${CONTEXT_PARALLEL_SIZE}",
        "DATASET_DIR": "/home/ext_kazuki_fujii_rio_gsic_titech/datasets/samples",
        "TRAIN_DATA_PATH": "",
        "JOB_NAME": "llama-3-8b-${NODE_TYPE}-${NUM_NODES}node-${NUM_GPUS}gpu-${SEQ_LENGTH}s-DP=${DATA_PARALLEL_SIZE}-TP=${TENSOR_PARALLEL_SIZE}-PP=${PIPELINE_PARALLEL_SIZE}-BS=${GLOBAL_BATCH_SIZE}-LR=${LR}-MINLR=${MIN_LR}-WARMUP=${LR_WARMUP_STEPS}-WD=${WEIGHT_DECAY}-GC=${GRAD_CLIP}-z-loss",
        "CHECKPOINT_ARGS": "--load ${CHECKPOINT_SAVE_DIR}",
        "CUDA_DEVICE_MAX_CONNECTIONS": "1",
        "PATH": "$PATH",
        "NCCL_DEBUG": "INFO",
        "NCCL_DEBUG_SUBSYS": "INIT,GRAPH,ENV,TUNING"
    },
    "resources": {
        "gres": "gpu",
        "cpus_per_task": "1",
        "tasks": "$NUM_GPUS",
        "ntasks_per_code": "$NUM_GPUS",
        "gpus": "$NUM_GPUS",
        "gpus_per_node": "8",
        "cores_per_socket": null,
        "gpus_per_task": "1",
        "exclusive": "true",
        "cpus_per_gpu": null,
        "gpu_type": "H100",
        "time": null,
        "ntasks_per_node": "8",
        "nodes": "2",
        "memory": null,
        "sockets_per_node": null,
        "ntasks_per_socket": null,
        "mem_per_gpu": null,
        "mem_per_cpu": null,
        "gres_flags": "a3"
    },
    "versions": {}
}