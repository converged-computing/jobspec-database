{
    "application": "Legion",
    "software": [
        "gcc/7.3.1",
        "cmake/3.14.5",
        "cuda/11.7.0",
        "jsrun"
    ],
    "resources": [
        "Lassen",
        "GPUs"
    ],
    "libraries": [
        "LD_LIBRARY_PATH"
    ],
    "parameters": {
        "numgpus": 4,
        "repeat": 5,
        "oricmd": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2 ",
        "dslcmd": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2  -dslmapper -mapping $root_dir/circuit_mappings -tm:select_source_by_bandwidth -tm:use_semantic_name ",
        "ori_wrapper": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2  -lg:inorder -wrapper -level mapper=debug -logfile oriwrapper_${numnodes}_${numgpus}_%.wrapper ",
        "dsl_wrapper": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2  -dslmapper -mapping $root_dir/circuit_mappings -tm:select_source_by_bandwidth -tm:use_semantic_name  -lg:inorder -wrapper -level mapper=debug nsmapper=debug -logfile dslwrapper_${numnodes}_${numgpus}_%.wrapper ",
        "ori_prof": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2  -lg:prof ${numnodes} -lg:prof_logfile oriprof_circuit_${numnodes}_${numgpus}_%.gz ",
        "dsl_prof": "-pps 10 -prune 30 -hl:sched 1024 -ll:gpu ${numgpus} -ll:util 2 -ll:bgwork 2 -ll:csize 150000 -ll:fsize 15000 -ll:zsize 2048 -ll:rsize 512 -ll:gsize 0 -level 5 -dm:replicate 1 -dm:same_address_space -dm:memoize -lg:no_fence_elision -lg:parallel_replay 2  -dslmapper -mapping $root_dir/circuit_mappings -tm:select_source_by_bandwidth -tm:use_semantic_name  -lg:prof ${numnodes} -lg:prof_logfile dslprof_circuit_${numnodes}_${numgpus}_%.gz "
    },
    "commands": [
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $oricmd",
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $ori_wrapper",
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $ori_prof",
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $dslcmd",
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $dsl_wrapper",
        "jsrun -b none -c ALL_CPUS -g ALL_GPUS -r 1 -n $n \"$root_dir/circuit\" -npp 5000 -wpp 20000 -l 50 -p $(( $n * 40 )) $dsl_prof"
    ]
}