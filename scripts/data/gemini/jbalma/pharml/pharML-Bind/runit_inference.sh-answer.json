{
    "application": "Horovod",
    "details": {
        "software": [
            "conda",
            "pip",
            "python",
            "tensorflow",
            "horovod",
            "rdkit",
            "biopython",
            "scipy",
            "dask",
            "graph_nets",
            "dm-sonnet",
            "tensorflow_probability",
            "cmake"
        ],
        "resources": [
            "SLURM",
            "CUDA",
            "MPI",
            "SCRATCH",
            "CRAY_CUDA_MPS",
            "CUDA_VISIBLE_DEVICES",
            "TF_ENABLE_AUTO_MIXED_PRECISION",
            "CRAY_CUDA_PROXY",
            "TF_FP16_CONV_USE_FP32_COMPUTE",
            "TF_FP16_MATMUL_USE_FP32_COMPUTE",
            "HOROVOD_TIMELINE",
            "HOROVOD_FUSION_THRESHOLD",
            "HOROVOD_MPI_THREADS_DISABLE",
            "OMPI_MCA_btl_openib_allow_ib",
            "OMPI_MCA_btl",
            "UCX_TLS",
            "UCX_MEMTYPE_CACHE",
            "UCX_ACC_DEVICES",
            "UCX_NET_DEVICES",
            "DL_COMM_USE_CRCCL",
            "OMPI_MCA_btl_tcp_if_include",
            "NODES",
            "PPN",
            "PPS",
            "NP",
            "NC",
            "NT",
            "BS",
            "BS_TEST",
            "LR0",
            "MLP_LATENT",
            "MLP_LAYERS",
            "GNN_LAYERS",
            "NUM_FEATURES",
            "MODE",
            "EPOCHS",
            "INFER_OUT",
            "TEMP_DIR"
        ],
        "environment": [
            "conda create -y --prefix $INSTALL_DIR python=3.6 cudatoolkit=10.0 cudnn",
            "source activate $INSTALL_DIR/",
            "export PATH=${INSTALL_DIR}/bin:${PATH}",
            "conda install -y -c conda-forge rdkit biopython scipy dask",
            "conda install -y -c anaconda pip",
            "python -m pip install --force-reinstall graph_nets \"tensorflow_gpu>=1.15,<2\" \"dm-sonnet<2\" \"tensorflow_probability<0.9\"",
            "conda install cmake",
            "conda install pip",
            "pip uninstall horovod",
            "export CMAKE_CXX_COMPILER=$MPI_CXX",
            "export CMAKE_CC_COMPILER=$MPI_CC",
            "export HOROVOD_ALLOW_MIXED_GPU_IMPL=0",
            "HOROVOD_BUILD_ARCH_FLAGS=\"-mavx256\" HOROVOD_CUDA_HOME=${CUDATOOLKIT_HOME} HOROVOD_MPICXX_SHOW=\"mpic++ -show\" HOROVOD_HIERARCHICAL_ALLREDUCE=0 HOROVOD_MPI_HOME=${MPI_PATH} HOROVOD_WITH_TENSORFLOW=1 HOROVOD_WITHOUT_PYTORCH=1 HOROVOD_WITHOUT_MXNET=1 pip install --global-option=build_ext --global-option=\"-I ${CUDATOOLKIT_HOME}/include\" --no-cache-dir horovod",
            "HOROVOD_BUILD_ARCH_FLAGS=\"-mavx256\" HOROVOD_WITH_TENSORFLOW=1 HOROVOD_WITHOUT_PYTORCH=1 HOROVOD_WITHOUT_MXNET=1 pip install --no-cache-dir horovod",
            "export SCRATCH=/lus/scratch/jbalma",
            "export CRAY_CUDA_MPS=1",
            "export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7",
            "export TF_ENABLE_AUTO_MIXED_PRECISION=1",
            "export CRAY_CUDA_PROXY=1",
            "export CRAY_CUDA_MPS=1",
            "export TF_FP16_CONV_USE_FP32_COMPUTE=0",
            "export TF_FP16_MATMUL_USE_FP32_COMPUTE=0",
            "export HOROVOD_TIMELINE=${SCRATCH_PAD}/timeline.json",
            "export HOROVOD_FUSION_THRESHOLD=256000000",
            "export HOROVOD_FUSION_THRESHOLD=500000",
            "export HOROVOD_FUSION_THRESHOLD=0",
            "export HOROVOD_MPI_THREADS_DISABLE=1",
            "export HOROVOD_FUSION_THRESHOLD=0",
            "export OMPI_MCA_btl_tcp_if_include=ib0"
        ]
    }
}