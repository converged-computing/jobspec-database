{
    "application": "Singularity",
    "details": {
        "runtime": "ROCM",
        "image": "/scratch/project_465000301/lumi-pytorch-rocm.simg",
        "environment_variables": [
            "PYTHONPATH=hep_tfds",
            "TFDS_DATA_DIR=/scratch/project_465000301/tensorflow_datasets",
            "MIOPEN_DISABLE_CACHE=true",
            "MIOPEN_USER_DB_PATH=/tmp/${USER}-${SLURM_JOB_ID}-miopen-cache",
            "MIOPEN_CUSTOM_CACHE_DIR=${MIOPEN_USER_DB_PATH}",
            "ROCM_PATH=/opt/rocm",
            "NCCL_DEBUG=WARN",
            "MIOPEN_ENABLE_LOGGING=1",
            "MIOPEN_ENABLE_LOGGING_CMD=1",
            "MIOPEN_LOG_LEVEL=4"
        ],
        "bind_points": [
            "/scratch/project_465000301",
            "/tmp"
        ],
        "python_script": "mlpf/pyg_pipeline.py",
        "arguments": [
            "--dataset cms",
            "--gpus $SLURM_GPUS_PER_TASK",
            "--data-dir $TFDS_DATA_DIR",
            "--config parameters/pytorch/pyg-cms.yaml",
            "--train",
            "--conv-type attention",
            "--attention-type flash_external",
            "--num-epochs 10",
            "--gpu-batch-multiplier 4",
            "--num-workers 1",
            "--prefetch-factor 10",
            "--checkpoint-freq 1"
        ],
        "slurm_resource_requirements": {
            "job_name": "mlpf-train-cms",
            "account": "project_465000301",
            "time": "3-00:00:00",
            "nodes": 1,
            "ntasks-per-node": 1,
            "cpus-per-task": 32,
            "mem": "130G",
            "gpus-per-task": 8,
            "partition": "small-g",
            "requeue": false,
            "output": "logs/slurm-%x-%j-%N.out"
        },
        "modules": [
            "LUMI/22.08",
            "partition/G"
        ]
    }
}