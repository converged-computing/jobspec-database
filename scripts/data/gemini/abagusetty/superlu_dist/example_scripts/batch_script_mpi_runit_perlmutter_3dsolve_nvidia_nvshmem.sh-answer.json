{
    "application": "SuperLU",
    "details": {
        "libraries": [
            "PrgEnv-nvidia",
            "cudatoolkit",
            "cray-libsci",
            "cmake",
            "nvshmem/2.11.0"
        ],
        "resources": {
            "compute_nodes": 16,
            "tasks_per_node": 4,
            "gpus": 64,
            "wall_time": "0:10:00",
            "queue": "regular",
            "account": "m2957"
        },
        "environment_variables": [
            "MPICH_GPU_SUPPORT_ENABLED=1",
            "CRAY_ACCEL_TARGET=nvidia80",
            "SUPERLU_LBS=GD",
            "SUPERLU_ACC_OFFLOAD=0",
            "GPU3DVERSION=0",
            "ANC25D=0",
            "NEW3DSOLVE=1",
            "NEW3DSOLVETREECOMM=1",
            "SUPERLU_BIND_MPI_GPU=1",
            "SUPERLU_MAXSUP=256",
            "SUPERLU_RELAX=64",
            "SUPERLU_MAX_BUFFER_SIZE=10000000",
            "SUPERLU_NUM_LOOKAHEADS=2",
            "SUPERLU_NUM_GPU_STREAMS=1",
            "SUPERLU_MPI_PROCESS_PER_GPU=1",
            "SUPERLU_N_GEMM=6000",
            "NVSHMEM_USE_GDRCOPY=1",
            "NVSHMEM_MPI_SUPPORT=1",
            "MPI_HOME=${MPICH_DIR}",
            "NVSHMEM_LIBFABRIC_SUPPORT=1",
            "LIBFABRIC_HOME=/opt/cray/libfabric/1.15.2.0",
            "NVSHMEM_DISABLE_CUDA_VMM=1",
            "FI_CXI_OPTIMIZED_MRS=false",
            "NVSHMEM_BOOTSTRAP_TWO_STAGE=1",
            "NVSHMEM_BOOTSTRAP=MPI",
            "NVSHMEM_REMOTE_TRANSPORT=libfabric",
            "OMP_NUM_THREADS=$NTH",
            "OMP_PLACES=threads",
            "OMP_PROC_BIND=spread",
            "SLURM_CPU_BIND=cores",
            "MPICH_MAX_THREAD_SAFETY=multiple"
        ],
        "commands": [
            "module load PrgEnv-nvidia",
            "module load cudatoolkit",
            "module load cray-libsci",
            "module load cmake",
            "module use /global/common/software/nersc/pe/modulefiles/latest",
            "module load nvshmem/2.11.0",
            "ulimit -s unlimited",
            "echo MPICH_GPU_SUPPORT_ENABLED=$MPICH_GPU_SUPPORT_ENABLED",
            "export LD_LIBRARY_PATH=${CRAY_LD_LIBRARY_PATH}:$LD_LIBRARY_PATH",
            "export NVSHMEM_HOME=/global/cfs/cdirs/m3894/lib/PrgEnv-gnu/nvshmem_src_2.8.0-3/build/",
            "export LD_LIBRARY_PATH=$NVSHMEM_HOME/lib:$LD_LIBRARY_PATH",
            "export NVSHMEM_DEBUG=TRACE",
            "export NVSHMEM_DEBUG_SUBSYS=ALL",
            "export NVSHMEM_DEBUG_FILE=nvdebug_success",
            "mkdir -p $MAT",
            "export SUPERLU_ACC_SOLVE=1",
            "srun -n $NCORE_VAL_TOT  -c $TH_PER_RANK --cpu_bind=cores ./EXAMPLE/pddrive3d -c $NCOL -r $NROW -d $NPZ -b $batch -i 0 -s $NRHS $CFS/m2957/liuyangz/my_research/matrix/$MAT | tee ./$MAT/SLU.o_mpi_${NROW}x${NCOL}x${NPZ}_${OMP_NUM_THREADS}_3d_newest_gpusolve_${SUPERLU_ACC_SOLVE}_nrhs_${NRHS}"
        ],
        "execution_environment": "NERSC"
    }
}