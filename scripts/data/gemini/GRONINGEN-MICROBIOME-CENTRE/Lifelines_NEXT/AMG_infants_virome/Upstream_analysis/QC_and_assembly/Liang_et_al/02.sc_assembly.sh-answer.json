{
    "application": "SPAdes",
    "other_software": [
        "QUAST",
        "filter_contigs.pl"
    ],
    "resource_requirements": {
        "memory": "32gb",
        "time": "4:59:00",
        "cpus": 4
    },
    "modules": [
        "SPAdes/3.15.3-GCC-11.2.0",
        "QUAST"
    ],
    "environment_variables": [
        "SLURM_MEM_PER_NODE",
        "SLURM_CPUS_PER_TASK"
    ],
    "input_files": [
        "../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_1.fastq.gz",
        "../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_2.fastq.gz",
        "../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_unmatched.fastq.gz"
    ],
    "output_files": [
        "../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_spades.log",
        "../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.fasta",
        "../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_scaffolds.fasta",
        "../SAMPLES/${SAMPLE_ID}/01_sc_assembly/quast",
        "../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.min1kbp.fasta",
        "../SAMPLES/${SAMPLE_ID}/MD5.txt"
    ],
    "commands": [
        "mkdir -p ../SAMPLES/${SAMPLE_ID}/01_sc_assembly",
        "mkdir -p ${TMPDIR}/${SAMPLE_ID}/clean_reads/",
        "cp ../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_1.fastq.gz ${TMPDIR}/${SAMPLE_ID}/clean_reads/",
        "cp ../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_2.fastq.gz ${TMPDIR}/${SAMPLE_ID}/clean_reads/",
        "cp ../SAMPLES/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_unmatched.fastq.gz ${TMPDIR}/${SAMPLE_ID}/clean_reads/",
        "module purge",
        "module load SPAdes/3.15.3-GCC-11.2.0",
        "spades.py --sc --only-assembler -k 21,33,55,77,99,127 -1 ${TMPDIR}/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_1.fastq.gz -2 ${TMPDIR}/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_paired_2.fastq.gz -s ${TMPDIR}/${SAMPLE_ID}/clean_reads/${SAMPLE_ID}_dedup_unmatched.fastq.gz -o ${TMPDIR}/${SAMPLE_ID}/01_sc_assembly -m $((${SLURM_MEM_PER_NODE} / 1024)) --threads ${SLURM_CPUS_PER_TASK}",
        "cp ${TMPDIR}/${SAMPLE_ID}/01_sc_assembly/spades.log ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_spades.log",
        "cp ${TMPDIR}/${SAMPLE_ID}/01_sc_assembly/contigs.fasta ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.fasta",
        "cp ${TMPDIR}/${SAMPLE_ID}/01_sc_assembly/scaffolds.fasta ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_scaffolds.fasta",
        "rm -r ${TMPDIR}/${SAMPLE_ID}/clean_reads",
        "rm -r ${TMPDIR}/${SAMPLE_ID}/01_sc_assembly",
        "module load QUAST",
        "quast.py ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.fasta -o ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/quast -m $((${SLURM_MEM_PER_NODE} / 1024)) --threads ${SLURM_CPUS_PER_TASK}",
        "perl filter_contigs.pl 1000 ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.fasta > ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.min1kbp.fasta",
        "sed -i 's/>NODE/>'${SAMPLE_ID}'_NODE/g' ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.min1kbp.fasta",
        "md5sum ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_contigs.fasta >> ../SAMPLES/${SAMPLE_ID}/MD5.txt",
        "md5sum ../SAMPLES/${SAMPLE_ID}/01_sc_assembly/${SAMPLE_ID}_scaffolds.fasta >> ../SAMPLES/${SAMPLE_ID}/MD5.txt",
        "module list",
        "module purge"
    ]
}