#!/bin/bash
#SBATCH --job-name=exp
#SBATCH --nodelist=compute-107,compute-108
#SBATCH --partition=benchmark
#SBATCH --output=LOG-%j-%x.out
#SBATCH --nodes=2
#SBATCH --ntasks-per-node=8 # Request n cores or task per node
#SBATCH --exclusive


## Approach 0 - Correct
mpirun \
    --map-by ppr:8:node \
    a.out


# ### Approach 1 - Correct
# ### `ntasks-per-node=8` of sbatch is valid with srun
# srun \
#     --mpi=pmix \
#     a.out


# ### Approach 2 - Correct
# mpirun \
#     -N 8 \
#     --mca pml ^cm --mca btl tcp,self --mca btl_tcp_if_exclude lo,docker0 --bind-to none \
#     a.out


# ### Approach 3 - Incorrect
# ### num processes default to num slots
# mpirun \
#     --mca pml ^cm --mca btl tcp,self --mca btl_tcp_if_exclude lo,docker0 --bind-to none \
#     a.out



<<comment
sbatch ./run.sbatch

Output of Approach 0

SIZE 16  RANK 3
SIZE 16  RANK 0
SIZE 16  RANK 1
SIZE 16  RANK 4
SIZE 16  RANK 11
SIZE 16  RANK 13
SIZE 16  RANK 15
SIZE 16  RANK 9
SIZE 16  RANK 12
SIZE 16  RANK 10
SIZE 16  RANK 8
SIZE 16  RANK 14
SIZE 16  RANK 2
SIZE 16  RANK 6
SIZE 16  RANK 5
SIZE 16  RANK 7


Output of Approach 1

[sauron@ip-10-0-12-252 pmix]$ cat LOG-24920-exp.out 
SIZE 16  RANK 11
SIZE 16  RANK 4
SIZE 16  RANK 0
SIZE 16  RANK 7
SIZE 16  RANK 3
SIZE 16  RANK 5
SIZE 16  RANK 1
SIZE 16  RANK 2
SIZE 16  RANK 6
SIZE 16  RANK 15
SIZE 16  RANK 12
SIZE 16  RANK 10
SIZE 16  RANK 8
SIZE 16  RANK 13
SIZE 16  RANK 9
SIZE 16  RANK 14


Output of Approach 2

SIZE 16  RANK 0
SIZE 16  RANK 1
SIZE 16  RANK 4
SIZE 16  RANK 6
SIZE 16  RANK 5
SIZE 16  RANK 7
SIZE 16  RANK 3
SIZE 16  RANK 2
SIZE 16  RANK 12
SIZE 16  RANK 14
SIZE 16  RANK 15
SIZE 16  RANK 10
SIZE 16  RANK 13
SIZE 16  RANK 8
SIZE 16  RANK 11
SIZE 16  RANK 9


Output of Approach 3

SIZE 192  RANK 0
SIZE 192  RANK 53
SIZE 192  RANK 61
SIZE 192  RANK 22
SIZE 192  RANK 23
SIZE 192  RANK 24
SIZE 192  RANK 25
SIZE 192  RANK 26
SIZE 192  RANK 27
SIZE 192  RANK 28
SIZE 192  RANK 29
SIZE 192  RANK 30
SIZE 192  RANK 31
SIZE 192  RANK 32
SIZE 192  RANK 33
SIZE 192  RANK 34
SIZE 192  RANK 35
SIZE 192  RANK 36
SIZE 192  RANK 37
SIZE 192  RANK 38
SIZE 192  RANK 39
SIZE 192  RANK 40
SIZE 192  RANK 41
SIZE 192  RANK 42
SIZE 192  RANK 43
SIZE 192  RANK 44
SIZE 192  RANK 45
SIZE 192  RANK 46
SIZE 192  RANK 47
SIZE 192  RANK 48
SIZE 192  RANK 49
SIZE 192  RANK 50
SIZE 192  RANK 51
SIZE 192  RANK 52
SIZE 192  RANK 54
SIZE 192  RANK 55
SIZE 192  RANK 56
SIZE 192  RANK 57
SIZE 192  RANK 58
SIZE 192  RANK 59
SIZE 192  RANK 60
SIZE 192  RANK 62
SIZE 192  RANK 63
SIZE 192  RANK 64
SIZE 192  RANK 65
SIZE 192  RANK 66
SIZE 192  RANK 67
SIZE 192  RANK 68
SIZE 192  RANK 69
SIZE 192  RANK 70
SIZE 192  RANK 71
SIZE 192  RANK 72
SIZE 192  RANK 73
SIZE 192  RANK 74
SIZE 192  RANK 75
SIZE 192  RANK 76
SIZE 192  RANK 77
SIZE 192  RANK 78
SIZE 192  RANK 79
SIZE 192  RANK 80
SIZE 192  RANK 81
SIZE 192  RANK 82
SIZE 192  RANK 83
SIZE 192  RANK 84
SIZE 192  RANK 85
SIZE 192  RANK 86
SIZE 192  RANK 87
SIZE 192  RANK 88
SIZE 192  RANK 89
SIZE 192  RANK 90
SIZE 192  RANK 91
SIZE 192  RANK 92
SIZE 192  RANK 93
SIZE 192  RANK 94
SIZE 192  RANK 95
SIZE 192  RANK 1
SIZE 192  RANK 2
SIZE 192  RANK 3
SIZE 192  RANK 4
SIZE 192  RANK 5
SIZE 192  RANK 6
SIZE 192  RANK 7
SIZE 192  RANK 8
SIZE 192  RANK 9
SIZE 192  RANK 10
SIZE 192  RANK 11
SIZE 192  RANK 12
SIZE 192  RANK 13
SIZE 192  RANK 14
SIZE 192  RANK 15
SIZE 192  RANK 16
SIZE 192  RANK 17
SIZE 192  RANK 18
SIZE 192  RANK 19
SIZE 192  RANK 20
SIZE 192  RANK 21
SIZE 192  RANK 121
SIZE 192  RANK 101
SIZE 192  RANK 105
SIZE 192  RANK 119
SIZE 192  RANK 124
SIZE 192  RANK 127
SIZE 192  RANK 169
SIZE 192  RANK 175
SIZE 192  RANK 177
SIZE 192  RANK 180
SIZE 192  RANK 97
SIZE 192  RANK 126
SIZE 192  RANK 161
SIZE 192  RANK 171
SIZE 192  RANK 172
SIZE 192  RANK 182
SIZE 192  RANK 100
SIZE 192  RANK 103
SIZE 192  RANK 106
SIZE 192  RANK 111
SIZE 192  RANK 112
SIZE 192  RANK 190
SIZE 192  RANK 191
SIZE 192  RANK 99
SIZE 192  RANK 102
SIZE 192  RANK 116
SIZE 192  RANK 130
SIZE 192  RANK 140
SIZE 192  RANK 151
SIZE 192  RANK 164
SIZE 192  RANK 165
SIZE 192  RANK 170
SIZE 192  RANK 160
SIZE 192  RANK 167
SIZE 192  RANK 174
SIZE 192  RANK 179
SIZE 192  RANK 181
SIZE 192  RANK 185
SIZE 192  RANK 187
SIZE 192  RANK 96
SIZE 192  RANK 104
SIZE 192  RANK 110
SIZE 192  RANK 113
SIZE 192  RANK 118
SIZE 192  RANK 122
SIZE 192  RANK 125
SIZE 192  RANK 128
SIZE 192  RANK 143
SIZE 192  RANK 146
SIZE 192  RANK 153
SIZE 192  RANK 154
SIZE 192  RANK 141
SIZE 192  RANK 142
SIZE 192  RANK 144
SIZE 192  RANK 145
SIZE 192  RANK 148
SIZE 192  RANK 149
SIZE 192  RANK 150
SIZE 192  RANK 159
SIZE 192  RANK 188
SIZE 192  RANK 107
SIZE 192  RANK 108
SIZE 192  RANK 109
SIZE 192  RANK 114
SIZE 192  RANK 120
SIZE 192  RANK 129
SIZE 192  RANK 132
SIZE 192  RANK 133
SIZE 192  RANK 134
SIZE 192  RANK 135
SIZE 192  RANK 136
SIZE 192  RANK 138
SIZE 192  RANK 156
SIZE 192  RANK 157
SIZE 192  RANK 158
SIZE 192  RANK 163
SIZE 192  RANK 166
SIZE 192  RANK 168
SIZE 192  RANK 173
SIZE 192  RANK 176
SIZE 192  RANK 178
SIZE 192  RANK 183
SIZE 192  RANK 184
SIZE 192  RANK 186
SIZE 192  RANK 189
SIZE 192  RANK 98
SIZE 192  RANK 115
SIZE 192  RANK 117
SIZE 192  RANK 123
SIZE 192  RANK 131
SIZE 192  RANK 137
SIZE 192  RANK 139
SIZE 192  RANK 147
SIZE 192  RANK 152
SIZE 192  RANK 155
SIZE 192  RANK 162

comment